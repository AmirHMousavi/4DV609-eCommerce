# Message Service
Message Service provides functionality for sending and receiving a message. Descriptor of Message Service is defined with service calls: sendMessage(), getMessage(), getAllMessagesByItemId(). These are methods defined in the message service that return service call.
Service calls

A service call for an entity has a request and a response entity.

`sendMessage()` - Request parameter CreateMessageRequest is an immutable class that is generated by AbstractCreateMessageRequest and CreateMessageResponse is an immutable class generated by AbstractCreateMessageResponse. This service call returns messageId of type UUID. 
```sh
ServiceCall<CreateMessageRequest, CreateMessageResponse> sendMessage()
````

To call the service sendMessage(), use the following REST call:
```sh
Service.restCall(Method.POST, "/api/message/send", this::sendMessage)
````
* A REST service call descriptor, identified by the given HTTP method and path pattern.
* Method.POST - is a transport method. If the transport is HTTP, this maps down to an HTTP method.

`getMessage()` - service call is used to receive single message. As a response is Message object. Message is an immutable implementation of AbstractMessage.
```sh
ServiceCall<NotUsed, Message> getMessage(String messageId)
````

To call the service getMessage(), use the following REST call:
```sh
Service.restCall(Method.GET, "/api/message/:messageId", this::getMessage)
````

`getAllMessagesByItemId()` - This service call as a response has PSequence Message object that will return list of messages by itemId.  PSequence is an immutable, persistent indexed collection.

```sh
ServiceCall<NotUsed, PSequence<Message>> getAllMessagesByItemId(String itemId)
````

To call the service getAllMessagesByItemId(), use the following REST call:
```sh
Service.restCall(Method.GET, "/api/message/all/:itemId", this::getAllMessagesByItemId)
````

##### Implementation

```sh
Folder Structure of Message-Impl
---org
   ---ecommerce
    	---message
        	---impl
                	AbstractMessageState.java
                	MessageCommand.java
                	MessageEntity.java
                	MessageEvent.java
                	MessageEventProcessor.java
                	MessageEventTag.java
                	MessageModule.java
                	MessageServiceImpl.java
 ```
###### MessageServiceImpl.java

This class ‘MessageServiceImpl’ is providing an implementation of the service descriptor interface, implementing each call specified by that descriptor.

* `sendMessage()` - is command set in MessageEntity. The command execution results in MessageCreated event. The event then notifies MessageEventProcessor to prepare read-side database. While using this command user express the interest for particular item.
* `getMessage()` - is a read-only command and replies to the GET request by returning the getMessageReply of Message object. The command is handled by ReadOnlyCommandHandler.
* `getAllMessagesbyItemId()` - is a direct query from readside. An instance of the cassandraSession is injected in the MessageServiceImpl and a completionStage with a collection of messages for particular itemId is returned using the following query ("SELECT * FROM message"WHERE itemId = ? ALLOW FILTERING) uuid).
